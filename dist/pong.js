!function(){"use strict";function t(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=1,this.ay=1,this.width=14,this.height=14,this.halfHeight=this.height/2,this.halfWidth=this.width/2,this.radius=6,this.restitution=2}function i(){}function e(){this.pressedKeys=[],this.keydown=function(t){this.pressedKeys[t.keyCode]=!0},this.keyup=function(t){this.pressedKeys[t.keyCode]=!1},document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this))}function h(t,i){this.x=t,this.y=i,this.width=10,this.height=80,this.score=0,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.restitution=1.1}function s(t){this.touches=[],this.touchMoveListener=function(t){},this.doubleTapListener=function(){},this.timeout=0,this.lastTap=0,t.addEventListener("touchstart",function(t){t.preventDefault();for(var i=0;i<t.changedTouches.length;i++){var e=t.changedTouches[i];this.touches[e.identifier]={x:e.clientX,y:e.clientY}}}.bind(this)),t.addEventListener("touchmove",function(t){t.preventDefault();for(var i=0;i<t.changedTouches.length;i++){var e=t.changedTouches[i],h=this.touches[e.identifier];this.touches[e.identifier]={x:e.clientX,y:e.clientY};var s={x:e.clientX-h.x,y:e.clientY-h.y};this.touchMoveListener({x:e.clientX,y:e.clientY,offset:s})}}.bind(this)),t.addEventListener("touchend",function(t){for(var i=0;i<t.changedTouches.length;i++)delete this.touches[t.changedTouches[i].identifier];var e=(new Date).getTime(),h=e-lastTap;clearTimeout(timeout),500>h&&h>0?(this.doubleTapListener(),event.preventDefault()):timeout=setTimeout(function(){clearTimeout(timeout)},500),lastTap=e}.bind(this))}function o(t,i){this.x=t,this.y=i,this.value=0}function n(){var n=this,a=document.getElementById("game");this.width=a.width,this.height=a.height,this.context=a.getContext("2d"),this.context.fillStyle="white",this.keys=new e,this.touches=new s(a),this.collisions=new i,this.keys.addKeyPressListener(r,function(t){n.showMenu(),n.paused?n.paused=!1:n.paused=!0}),this.paused=!0,this.p1=new h(5,0),this.p1.y=this.height/2-this.p1.height/2,this.display1=new o(this.width/4,35),this.p2=new h(this.width-5-10,0),this.p2.y=this.height/2-this.p2.height/2,this.display2=new o(3*this.width/4,35),this.displayPaused=new o(this.width/2-20,this.height/2-10),this.touches.doubleTapListener=function(){this.paused||(this.showMenu(),this.paused=!0)},this.touches.touchMoveListener=function(t){t.x<n.width/2?t.offset.y<0?n.p1.y=Math.max(0,n.p1.y+t.offset.y):n.p1.y=Math.min(n.height-n.p1.height,n.p1.y+t.offset.y):t.x>n.width/2&&(t.offset.y<0?n.p2.y=Math.max(0,n.p2.y+t.offset.y):n.p2.y=Math.min(n.height-n.p2.height,n.p2.y+t.offset.y))},this.ball=new t,this.ball.x=this.width/2,this.ball.y=this.height/2,this.ball.vy=Math.floor(8*Math.random()-6),this.ball.vx=7-Math.abs(this.ball.vy)}function a(t){u=requestAnimationFrame(a),d.update(),d.inputs(),d.draw()}t.prototype.update=function(){this.x+=this.vx,this.y+=this.vy},t.prototype.draw=function(t){var i=this.x+this.width/2,e=this.y+this.height/2,h=this.width/2;t.beginPath(),t.arc(i,e,h,0,2*Math.PI,!1),t.closePath(),t.fill()},t.prototype.getMidX=function(){return this.halfWidth+this.x},t.prototype.getMidY=function(){return this.halfHeight+this.y},t.prototype.getTop=function(){return this.y},t.prototype.getBottom=function(){return this.y+this.height},t.prototype.getLeft=function(){return this.x},t.prototype.getRight=function(){return this.x+this.width};var l=.004;i.prototype.collideRect=function(t,i){var e=t.getLeft(),h=t.getTop(),s=t.getRight(),o=t.getBottom(),n=i.getLeft(),a=i.getTop(),l=i.getRight(),r=i.getBottom();return!(a>o||h>r||n>s||e>l)},i.prototype.resolveElastic=function(t,i){var e=t.getMidX(),h=t.getMidY(),s=i.getMidX(),o=i.getMidY(),n=(s-e)/i.halfWidth,a=(o-h)/i.halfHeight,r=Math.abs(n),d=Math.abs(a);Math.abs(r-d)<.25?(0>n?t.x=i.getRight():t.x=i.getLeft()-t.width,0>a?t.y=i.getBottom():t.y=i.getTop()-t.height,Math.random()<.5?(t.vx=-t.vx*i.restitution,Math.abs(t.vx)<l&&(t.vx=0)):(t.vy=-t.vy*i.restitution,Math.abs(t.vy)<l&&(t.vy=0))):r>d?(0>n?t.x=i.getRight():t.x=i.getLeft()-t.width,t.vx=-t.vx*i.restitution,Math.abs(t.vx)<l&&(t.vx=0)):(0>a?t.y=i.getBottom():t.y=i.getTop()-t.height,t.vy=-t.vy*i.restitution,Math.abs(t.vy)<l&&(t.vy=0))},e.prototype.isPressed=function(t){return!!this.pressedKeys[t]},e.prototype.addKeyPressListener=function(t,i){document.addEventListener("keypress",function(e){e.keyCode==t&&i(e)})},h.prototype.draw=function(t){t.fillRect(this.x,this.y,this.width,this.height)},h.prototype.getMidX=function(){return this.halfWidth+this.x},h.prototype.getMidY=function(){return this.halfHeight+this.y},h.prototype.getTop=function(){return this.y},h.prototype.getBottom=function(){return this.y+this.height},h.prototype.getLeft=function(){return this.x},h.prototype.getRight=function(){return this.x+this.width},o.prototype.draw=function(t){t.fillText(this.value,this.x,this.y),t.font="30px Verdana"},o.prototype.drawPaused=function(t){t.fillText("PAUSED",this.x,this.y),t.font="60px Verdana"};var r=112;n.prototype.resetGame=function(){this.p1.score=0,this.p2.score=0,this.p1.y=this.height/2-this.p1.height/2,this.p2.y=this.height/2-this.p2.height/2,this.ball.x=this.width/2,this.ball.y=this.height/2,this.ball.vy=Math.floor(8*Math.random()-6),this.ball.vx=7-Math.abs(this.ball.vy)},n.prototype.showMenu=function(){var t=document.getElementById("menu");this.paused?t.style.visibility="hidden":t.style.visibility="visible"},n.prototype.draw=function(){this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(this.width/2,0,2,this.height),this.ball.draw(this.context),this.p1.draw(this.context),this.p2.draw(this.context),this.display1.draw(this.context),this.display2.draw(this.context)},n.prototype.inputs=function(){this.paused||(this.display1.value=this.p1.score,this.display2.value=this.p2.score,this.keys.isPressed(83)?this.p1.y=Math.min(this.height-this.p1.height,this.p1.y+4):this.keys.isPressed(87)&&(this.p1.y=Math.max(0,this.p1.y-4)),this.keys.isPressed(40)?this.p2.y=Math.min(this.height-this.p2.height,this.p2.y+4):this.keys.isPressed(38)&&(this.p2.y=Math.max(0,this.p2.y-4)))},n.prototype.update=function(){this.paused||(this.ball.update(),this.collisions.collideRect(this.ball,this.p2)&&this.collisions.resolveElastic(this.ball,this.p2),this.collisions.collideRect(this.ball,this.p1)&&this.collisions.resolveElastic(this.ball,this.p1),(this.ball.vy<0&&this.ball.y<0||this.ball.vy>0&&this.ball.y+this.ball.height>this.height)&&(this.ball.vy=-this.ball.vy),this.ball.x>=this.width?this.score(this.p1):this.ball.x+this.ball.width<=0&&this.score(this.p2))},n.prototype.score=function(t){t.score++;var i=t==this.p1?0:1;this.ball.x=this.width/2,this.ball.y=t.y+t.height/2,this.ball.vy=Math.floor(8*Math.random()-6),this.ball.vx=7-Math.abs(this.ball.vy),1==i&&(this.ball.vx*=-1)};var d=new n,u=null;document.getElementById("resume-game").onclick=function(){d.showMenu(),d.paused=!1},document.getElementById("new-game").onclick=function(){d.resetGame(),d.showMenu(),d.paused=!1},u=window.requestAnimationFrame(a)}();
//# sourceMappingURL=pong.js.map